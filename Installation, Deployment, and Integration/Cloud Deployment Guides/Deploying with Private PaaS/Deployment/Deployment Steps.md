# Deployment Steps

To begin a the Private PaaS deployment process, you must first establish basic networking for your deployment.

### Default Security Assumptions

Our default assumptions for data and network security are derived from compliance and regulation frameworks; if your requirements exceed this baseline you may choose to modify steps or add additional security layers. We assume a minimum of TLS 1.2 for data in transit and RSA 256 bit encryption for data at rest. Profisee uses OpenID Connect 2.0 authentication providers: for example, Azure, Okta and Google. Part of these instructions include a sample Azure Firewall deployment. This is a default configuration that is provided for context and not a guideline; Profisee assumes that any firewall or virtual network appliance used will be configured according to the standards of your organization.

### Create a Resource Group

Our sample architecture uses two resource groups. The first resource group, the App resource group, will be created by you and will contain all the resources that you will configure. The second resource group, also known as the node resource group, will be automatically created during deployment by the AKS resource provider. This node resource group **cannot** be pre-created. If you don't specify a name for it, it will be given an autogenerated name: *MC\_<AppResourceGroup>\_<AKSCluster>\_<region>* and will contain infrastructure associated with the cluster, such as the Virtual Machine Scale Sets for the Windows and Linux node pools.

#### Deploy App Resource Group

az group create -l <region> -n <AppResourceGroup>

## Create Basic Networking

Within the App resource group, you will create several virtual networks.

### Deploy Spoke Virtual Network with AKS Subnet

Azure documentation for: [az network vnet](https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest)

*Make sure that the AKS subnet CIDR you choose does not overlap with any other network ranges and is sized appropriately. Profisee recommends that the AKS subnet should be at least a /24 subnet, as we will be using Azure Container Networking Interface (CNI)* [*plug-in*](https://docs.microsoft.com/en-us/azure/aks/configure-azure-cni).

```
az network vnet create -n <SpokeVirtualNetwork> -g <AppResourceGroup> --address-prefixes 10.0.0.0/23 --subnet-name <AKSSubnet> --subnet-prefix 10.0.0.0/24
```

### Add subnet to hold Private Endpoints and Virtual Machine Jumpbox

Azure documentation for: [az network vnet](https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest), [az network vnet subnet](https://docs.microsoft.com/en-us/cli/azure/network/vnet/subnet?view=azure-cli-latest)

*This subnet holds the jumpbox that is used to privately communicate with AKS and the private endpoints used to connect to different Azure Services. Each private endpoint uses one IP address.*

```
az network vnet subnet create -n <AppSubnet> -g <AppResourceGroup> --address-prefixes 10.0.1.0/24 --vnet-name <SpokeVirtualNetwork>
```

### Deploy Hub Virtual Network with AzureFirewallSubnet Subnet and Bastion Subnet

Azure documentation for: [az network vnet](https://docs.microsoft.com/en-us/cli/azure/network/vnet?view=azure-cli-latest)

*We are working under the assumption that traffic from AKS will be routed through an appliance like a firewall, gateway or proxy. While this appliance may already exist in your organization, we are including sample setup instructions for Azure Firewall. The AzureFirewallSubnet must have that exact name and must be a /26.*

*We are adding a Bastion subnet to allow connection to the Jumpbox virtual machines without the use of public Ips. The subnet must be named exactly AzureBastionSubnet and be a /26 or larger. You may choose to connect using a different method (public IP, Virtual Network Gateway).*

```
az network vnet create -n <HubVirtualNetwork> -g <AppResourceGroup> --address-prefixes 10.0.2.0/25 --subnet-name AzureFirewallSubnet --subnet-prefix 10.0.2.0/26
az network vnet subnet create -n AzureBastionSubnet-g <AppResourceGroup> --address-prefixes 10.0.2.64/26 --vnet-name <HubVirtualNetwork>
```

## Peer Virtual Networks

A peering will need to exist between the two virtual networks to allow resources to communicate.

Peer Hub and Spoke Virtual Networks

Azure documentation for: [az network vnet peering](https://docs.microsoft.com/en-us/cli/azure/network/vnet/peering?view=azure-cli-latest)

```
az network vnet peering create -n <HubtoSpokePeering> -g <AppResourceGroup> --vnet-name <HubVirtualNetwork> --remote-vnet <SpokeVirtualNetwork> --allow-forwarded-traffic --allow-vnet-access
az network vnet peering create -n <SpoketoHubPeering> -g <AppResourceGroup> --vnet-name <SpokeVirtualNetwork> --remote-vnet <HubVirtualNetwork> --allow-forwarded-traffic --allow-vnet-access
```

### Next Step

[Configuring Private DNS Zones](https://support.profisee.com/wikis/profiseeplatform/configure_private_dns_zones)