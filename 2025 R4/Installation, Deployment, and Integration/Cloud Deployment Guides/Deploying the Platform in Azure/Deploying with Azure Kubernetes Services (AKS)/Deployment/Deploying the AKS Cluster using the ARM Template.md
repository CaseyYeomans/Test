# Deploying the AKS Cluster using the ARM Template

To begin the deployment process, navigate to the [Kubernetes section of the Profisee GitHub](https://github.com/Profisee/kubernetes/tree/master/Azure-ARM) and click **Deploy to Azure**. Specify all required properties in the Custom Deployment form that appears to prepare the platform for deployment. Some properties may be left blank depending on your environment.

Before you start the deployment, you must ensure that you have satisfied all of the prerequisites and have all of the information available that are the outputs from the various steps of the [Planning Your ARM Deployment](https://support.profisee.com/wikis/profiseeplatform/deploying_profisee_using_the_arm_template) process.

##

## Custom Deployment Properties

| | | |
| --- | --- | --- |
| **Property** | **Description** | **Rules & Guidance** |
| | | |
| **Basics** | | |
| **Subscription** | Select the Azure subscription to which the resources and costs associated with operating the AKS cluster will be associated. | |
| **Resource Group** | Specify the Resource Group that will contain the AKS cluster resources needed to run the Profisee Platform. You have the option to create a new Resource Group dedicated to the cluster or use an existing Resource Group. | If you choose to use an existing Resource Group, a Managed Identity must already exist at the Resource Group level with Contributor access to the specified Resource Group. If you choose to allow the provisioning process to automatically create a new Resource Group dedicated to the Profisee AKS cluster resources, the Managed Identity must have Contributor access at the Subscription level in order to create a Resource Group in the specified Subscription. |
| **Region** | Select the Azure data center location that will host the cluster. | Select the location that is closest to you and your users to minimize global network latency. |
| **User-Assigned Managed Identity** | Specify the Managed Identity that will be used by the custom deployment steps to provision and configure the resources in this Profisee AKS cluster. | You can use an existing Managed Identity, or you can create a new Managed Identity. There considerations for configuring a Managed Identity can be found in the Managed Identity Configuration Requirements seen in [Planning Your Managed Identity Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_managed_identity_configuration). |
| **Profisee** | | |
| **Use Key Vault?** | Select if you want to use Key Vault to automatically pull sensitive information, or if you want to manually enter those values into the template | |
| **Key Vault** | Select the Key Vaults where the secrets and (optionally) the certificate have been created | Secrets for the Profisee License, SQL Server user and passwords should already have been created in the Key Vault. If you are using your own certificate, that certificate should be available in the Key Vault. |
| **Version** | Select the version of Profisee you want to deploy. | |
| **Admin User Account** | Enter your Azure account user name. | This account becomes the first super administrator to be registered in the platform. This user will be able to log on and add other users to the platform. If a version with Purview is selected, you must satisfy the **Purview API URL**, **Purview Service Principal ID**, and **Purview Service Principal Secret** properties below. |
| **License** | Select the file with the Profisee License provided to you by Profisee Support. If using Key Vault, enter the name of the Secret that contains the license value. If a license has not been provided, contact Profisee at [support.profisee.com](https://support.profisee.com/) before you begin the deployment process. | For more details, see [Obtaining Your Profisee License](https://support.profisee.com/wikis/profiseeplatform/obtaining_your_profisee_license_and_container_registry_credentials) |
| Do you want the deployment to create a new Azure Active Directory app registration for you? | Specify whether a new Azure Active Directory App Registration should be created, or if the cluster should access an existing Azure Active Directory App Registration. | If **Yes** is selected, the Client Id below can be left blank because a new Azure Active Directory App Registration along with its associated Client Id will be created by the provisioning process. If **No** is selected, the Client Id below must be associated with an existing Azure Active Directory application (see below). |
| **Application Registration Client Id** | Enter the Client Id associated with your existing Azure Active Directory App Registration. | This will be used by the Profisee Platform for authentication. You can find your Azure Active Directory Client Id in the Azure Portal under **Azure Active Directory** > **App Registrations.** |
| **Purview API URL** | Enter the Purview API URL associated with your Purview service. | |
| **Purview Service Principal ID** | Enter the identification for the Service Principal associated with your Purview service. | Read more about creating a Service Principal [here](https://docs.microsoft.com/en-us/azure/purview/tutorial-using-rest-apis). |
| **Purview Service Principal Secret** | Enter the secret for the Service Principal associated with your Purview service. | Read more about creating a Service Principal [here](https://docs.microsoft.com/en-us/azure/purview/tutorial-using-rest-apis). |
| **Kubernetes** | | |
| **Cluster Name** | Enter the name of the Kubernetes cluster to create. | This name can contain only letters, numbers, underscores, and hyphens. The name must start and end with a letter or number. The name must be unique in the Resource Group containing the resources associated with this Profisee AKS cluster. For more details on the following Kubernetes properties, see [Planning Your Cluster & Network Requirements.](http:/profiseeplatform/support.profisee.com/wikis/profiseeplatform/planning_your_cluster_and_network_requirements) |
| **Linux VM Size** | Select the size of the Linux node within the Kubernetes cluster. | This VM is used to assist in the provisioning process and does not require extensive resources. If you are unsure how to appropriately size the VMs, refer to the [Azure VM Comparison guide](http:/profiseeplatform/azureprice.net/). This guide contains a list of the names of the listed sizes and their number of cores, memory, max disks, and price. |
| **Windows VM Size** | Select the size of the Windows server node within the Kubernetes cluster. | This VM hosts the container and requires more resources than the Linux VM. If you are unsure how to appropriately size the VMs, refer to the [Azure VM Comparison guide](http:/profiseeplatform/azureprice.net/). This guide contains a list of the names of the listed sizes and their number of cores, memory, max disks, and price. |
| **Windows Node Count** | Select the number of nodes to include within the cluster. | |
| **Configure Advanced Kubernetes networking settings?** | Select whether to use advanced networking settings or default networking settings. | If **No**, you may continue to the next tab. If **Yes**, you must satisfy the detailed networking settings (listed below). |
| **Virtual Network** | Enter the name of an existing Kubernetes Vnet that will contain this AKS deployment. | Leave this section blank to create a new one with defaults. |
| **Subnet** | Enter the subnet name that will contain the App Service Environment in the existing Vnet. | Leave blank if not using an existing Vnet. |
| **Service Cidr** | Enter a Classless Inter-Domain Routing (Cidr) notation IP range from which to assign service cluster IPs. | Internal IP address range for services within the cluster. |
| **DNS Service IP** | Enter the container's DNS server IP address. | The IP address of the DNS server of the Kubernetes cluster. |
| **Docker Bridge Cidr** | Enter a Classless Inter-Domain Routing (Cidr) notation IP for Docker bridge. | Defines the internal IP address range for the containers within a service. |
| **SQL** | | |
| **Create a new SQL Server?** | Specify whether a new SQL Server should be created, or whether this Profisee AKS cluster should use and existing Azure SQL DB or SQL Server IaaS instance. | If **Yes** is selected, the SQL Server name, user, password, and database name properties entered described below should be left blank because these will be created. If **No** is selected, you must enter the fully qualified domain name of an existing SQL Server accessible by this Azure subscription, and the credentials below (SQL Server User and SQL Server Password) must have administrative rights to the SQL Server Name specified. For more details, see [Planning your SQL Server Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_sql_server_configuration). |
| **Server Name** | Enter a globally unique SQL Server name. | This can contain only lowercase letters, numbers, and '-', but cannot start or end with '-' or have more than 63 characters. This must be an available and globally unique name. |
| **Server User** | Enter the SQL Server administration login name to be used with this server. If using Key Vault, enter the Secret that contains the SQL Server admin user name | If you entered **Yes** to the **SQL Server Create New** property, this SQL administrator account will be created when the SQL Server instance is created. If you entered **No** to the **SQL Server Create New** property, this SQL administrator login name must exist and will be used to access the SQL Server instance. The SQL Server User name must not contain a SQL Identifier or a typical system name (such as admin, administrator, sa, root, dbmanager, loginmanager, etc.) or a built-in database user or role (like dbo, guest, public, etc.). Your login name must not include non-alphanumeric characters. Your login name must not start with numbers or symbols. |
| **Password** | Enter the password associated with the **SQL Server User** specified above. If using Key Vault, enter the Secret that contains the SQL Server admin user name | If you entered **Yes** to the **SQL Server Create New** property, this password will be associated with the administrator account when the instance is created. If you entered **No** to the **SQL Server Create New** property, this password will be used to authenticate access to the SQL Server instance during the provisioning process. The password cannot contain the account name of the user, must be at least eight characters long, and must be no more than 128 characters in length. The password must contain characters from three of the following four categories: Latin uppercase letters (A through Z). Latin lowercase letters (a through z). Base 10 digits (0 through 9). Non-alphanumeric characters such as: exclamation point (!), dollar sign ($), number sign (#), or percent (%). |
| **Database Name** | Enter the name of the SQL Server database to create and/or use. | This database name is **Profisee** by default. This name has a maximum length of 128 characters and must be unique within the server. |
| **Storage** | | |
| **Storage Account (Create New)** | Specify whether a new storage account should be created, or if you want to use an existing one. | If you want to use an existing storage account, select from the list of storage accounts from the dropdown list. Select **Create New** to create a new storage. When selected, a key will be automatically generated and the **Storage Account Access Key** property below will be ignored. For more details, see [Planning Your File Storage Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_file_storage_configuration). |
| **Storage Account Name** | Enter a unique storage account name. | This name can contain only lowercase letters and numbers. This name must be between 3 and 24 characters. Storage account names are globally unique in Azure. |
| **Access Keys** | Enter the access key for your existing storage account. | If you selected **Yes** to the **Storage Account Create New** property, this field is not required and should be left blank. If you selected **No** to the **Storage Account Create New** property, you must specify the access key associated with the existing account. You can find your access keys in the [Azure portal](http:/profiseeplatform/portal.azure.com/#home) through the path: **Home** > **Resource groups** > **Storage Account** > **Access keys**. Two access keys are listed by default. Either key works for the purposes of deployment. |
| **Storage Account Type** | Select a storage account type. | For more information on Azure Storage capabilities and pricing, refer to the [Azure Storage Overview pricing guide](https://azure.microsoft.com/en-us/pricing/details/storage/). |
| **File Share** | Select the name of the file share in the storage account to use. | If you select an existing storage account, select the existing file share to use. This name can contain only lowercase letters, numbers, and hyphens, and must begin and end with a letter or a number. The name cannot contain two consecutive hyphens. |
| **Networking** | | |
| **Use default Azure DNS?** | Choose whether to use default Azure DNS and Let's Encrypt for certificates. | If **Yes**, you may continue to the next tab. If **No**, you must specify detailed networking requirements (listed below). |
| **Is your DNS in Azure?** | Specify whether or not your DNS hostname and domain is contained within Azure. | If **Yes**, your DNS Zone must be managed in Azure, and the DNS record will be updated automatically as part of the deployment process. You may continue to the next step. If **No**, you or your network administrator must update the DNS record manually. Use the IP address that is output from the **InstallProfiseePlatform** deployment step. After the cluster has been deployed, you can find this output within your Resource Group in the Azure portal under **Resource Groups** > **[Resource Group Name]** > **Access Control (IAM)** > **InstallProfiseePlatform** > **Outputs**. NOTE: The Profisee Platform will be deployed successfully even if the DNS server is not updated. However, the platform will not be usable or accessible until the DNS server is manually updated. For more details, see [Planning Your Managed Identity Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_managed_identity_configuration). |
| **DNS Host Name** | Enter the host name to use/create. | |
| **DNS Domain Name** | Enter the domain name to use. | |
| **DNS Domain Resource Group** | Enter the resource group in which the DNS zone (Domain name) resides. | |
| **Use Let's Encrypt?** | Choose whether to use Let's Encrypt for certificates, or to use your own certificates. | If **Yes**, you may continue to the next tab. if **No**, you must select files for your HTTPS Certificate and Private Key or specify the name of the Certificate in Key Vault that contains the certificate. |

The final tab allows you to review the summary of the entered properties and ensure all entered information is accurate. Once all required properties have been entered, agree to the terms and conditions and click **Purchase**. You will then be redirected to the Azure portal home page with a notification reading, "Deployment in progress..." Click this notification to be taken to the deployment progress page.![](https://Profisee.magentrixcloud.com/sys/staticasset/read/file-ife696522da38244.png)

After the final step **InstallProfiseePlatform** succeeds, the deployment is done, but the platform is not ready for use. Allow approximately an additional 10 minutes for the platform to start and be ready for use. During this time, AKS is downloading the container and running Profisee's Configuration Manager which configures the instance, creates the web sites and applications, creates the database, and deploys files to the file repository on the configured file share.

During the roughly 10 minutes it takes to download the container, you should use this time to open the firewall on your SQL Server machine if you are connecting to an existing SQL Server or Azure SQL Managed Instance. Refer to [Planning Your SQL Server Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_sql_server_configuration) for more details.

Once the deployment is complete, you will be given a link to the Profisee Portal within the cluster, and can then install the Profisee desktop client, the Command Line Utilities (CLU), and the Software Development Kit (SDK).

### See more

- [Deployment Overview](https://support.profisee.com/wikis/profiseeplatform/deploying_profisee_using_the_arm_template)
- [Planning Your Managed Identity Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_managed_identity_configuration)
- [Planning Your SQL Server Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_sql_server_configuration)
- [Planning Your File Storage Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_file_storage_configuration)
- [Planning Your HTTPS Security](https://support.profisee.com/wikis/profiseeplatform/planning_your_https_security)
- [Planning Your Cluster & Network Configuration](https://support.profisee.com/wikis/profiseeplatform/planning_your_cluster_and_network_requirements)
- [Obtaining Your Profisee License & Azure Container Registry Credentials](https://support.profisee.com/wikis/profiseeplatform/obtaining_your_profisee_license_and_container_registry_credentials)
- [Troubleshooting Errors and Failures](https://support.profisee.com/wikis/profiseeplatform/troubleshooting_errors_and_failures)
- [Logging in to the Profisee Instance](https://support.profisee.com/wikis/profiseeplatform/logging_on_to_the_profisee_instance)